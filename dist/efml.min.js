/*!
 * EFML v1.0.0
 * Copyright(c) Resornesy 2025
 * Licensed under MIT License
 */
!function(){const globalStore={vars:{},funcs:{}};let e;function parseValue(e){return"null"===(e=e.trim())?null:"undefined"!==e?"true"===e||"false"!==e&&(!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e):void 0}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function safeEval(e,t={}){try{const n={...globalStore.vars,...t};return new Function(...Object.keys(n),`return ${e}`)(...Object.values(n))}catch(e){return!1}}function executeStatement(e,t={}){try{const n={...globalStore.vars,...t};new Function(...Object.keys(n),e)(...Object.values(n)),Object.assign(globalStore.vars,n)}catch(e){}}const updateContent=function(e){let t;return function(...n){clearTimeout(t),t=setTimeout(()=>e.apply(this,n),50)}}(()=>{document.querySelectorAll("[data-dynamic-text]").forEach(e=>{if(e.closest("if-jum, elif-jum, else-jum, while-loop, for-loop")&&e.closest('[style*="display: none"]'))return;let t=e.textContent;t=t.replace(/\$\{#(\w+(?:\.\w+)?)\}/g,(e,t)=>{let n;return t.startsWith("local.")?"":(n=globalStore.vars[t],null===n?"null":void 0===n?"undefined":escapeHtml("object"==typeof n?JSON.stringify(n):String(n)))}),e.textContent=t}),document.querySelectorAll("exec-func").forEach(e=>{const t=e.getAttribute("name");if(!t)return void(e.innerHtml="");const n=globalStore.funcs[t];if(!n)return void(e.innerHTML=`<span style="color: red;">exec-func: func "${t}" not defined</span>`);const l=e.getAttribute("params")||"",o={};l.trim()&&l.split(",").forEach(e=>{const[t,n]=e.split(":").map(e=>e.trim());t&&n&&(o[t]=parseValue(n))});try{const t=n.execute(o),l=document.createElement("div");for(l.innerHTML=t,e.innerHTML="";l.firstChild;)e.appendChild(l.firstChild)}catch(t){e.innerHTML=`<span style="color: red;">exec-func error: ${t.message}</span>`}}),document.querySelectorAll("if-jum").forEach(e=>{let t=e,n=!1;const l=[e];for(;t.nextElementSibling&&["elif-jum","else-jum"].includes(t.nextElementSibling.tagName.toLowerCase());)l.push(t.nextElementSibling),t=t.nextElementSibling;l.forEach(e=>{const t=e.tagName.toLowerCase();let l=!1;"if-jum"===t||"elif-jum"===t?n||(l=safeEval(e.getAttribute("exp")||"false"),l&&(n=!0)):"else-jum"!==t||n||(l=!0),e.style.display=l?"block":"none",l&&e.querySelectorAll("[data-dynamic-text]").forEach(e=>{let t=e.getAttribute("data-original-text")||e.textContent;t=t.replace(/\$\{#(\w+)\}/g,(e,t)=>{const n=globalStore.vars[t];return null===n?"null":void 0===n?"undefined":escapeHtml("object"==typeof n?JSON.stringify(n):String(n))}),e.textContent=t,e.setAttribute("data-original-text",t)})})}),document.querySelectorAll("while-loop").forEach(e=>{e.innerHTML="",e.getAttribute("exp");const t=e.cloneNode(!0);t.removeAttribute("exp");let n=0;for(;safeEval(e.getAttribute("exp")||"false")&&n<1e3;){const l=t.cloneNode(!0);l.style.display="block";let o=!1,i=!1;if(l.querySelectorAll("[data-loop-control]").forEach(e=>{const t=e.getAttribute("data-loop-control");"@-break"===t?(i=!0,e.remove()):"@-continue"===t&&(o=!0,e.remove())}),i)break;o||(e.parentNode.insertBefore(l,e.nextSibling),l.querySelectorAll("set-var").forEach(e=>{const t=e.getAttribute("name");let n=e.textContent.trim();n.startsWith("$ {#")&&n.endsWith("}")?(n=n.slice(3,-1),n=safeEval(n)):n=parseValue(n),t&&(globalStore.vars[t]=n),e.remove()}),l.querySelectorAll("[data-dynamic-text]").forEach(e=>{let t=e.getAttribute("data-original-text")||e.textContent;t=t.replace(/\$\{#(\w+)\}/g,(e,t)=>{const n=globalStore.vars[t];return null===n?"null":void 0===n?"undefined":escapeHtml("object"==typeof n?JSON.stringify(n):String(n))}),e.textContent=t,e.setAttribute("data-original-text",t)})),n++}e.style.display="none"}),document.querySelectorAll("for-loop").forEach(e=>{e.innerHTML="";const t=e.getAttribute("init")||"",n=e.getAttribute("exp")||"false",l=e.getAttribute("update")||"",o=e.cloneNode(!0);o.removeAttribute("init"),o.removeAttribute("exp"),o.removeAttribute("update"),t&&executeStatement(t);let i=0;for(;safeEval(n)&&i<1e3;){const t=o.cloneNode(!0);t.style.display="block";let n=!1,s=!1;if(t.querySelectorAll("[data-loop-control]").forEach(e=>{const t=e.getAttribute("data-loop-control");"@-break"===t?(s=!0,e.remove()):"@-continue"===t&&(n=!0,e.remove())}),s)break;n||(e.parentNode.insertBefore(t,e.nextSibling),t.querySelectorAll("set-var").forEach(e=>{const t=e.getAttribute("name");let n=e.textContent.trim();n.startsWith("$ {#")&&n.endsWith("}")?(n=n.slice(3,-1),n=safeEval(n)):n=parseValue(n),t&&(globalStore.vars[t]=n),e.remove()}),t.querySelectorAll("[data-dynamic-text]").forEach(e=>{let t=e.getAttribute("data-original-text")||e.textContent;t=t.replace(/\$\{#(\w+)\}/g,(e,t)=>{const n=globalStore.vars[t];return null===n?"null":void 0===n?"undefined":escapeHtml("object"==typeof n?JSON.stringify(n):String(n))}),e.textContent=t,e.setAttribute("data-original-text",t)})),l&&executeStatement(l),i++}e.style.display="none"})});class t extends HTMLElement{connectedCallback(){const e=this.getAttribute("name");let t=this.textContent.trim();t.startsWith("$ {#")&&t.endsWith("}")?(t=t.slice(3,-1),t=safeEval(t)):t=parseValue(t),e&&(globalStore.vars[e]=t,updateContent()),this.style.display="none"}}customElements.define("set-var",t);class n extends HTMLElement{connectedCallback(){const e=this.getAttribute("name");e&&this.textContent.trim()&&(globalStore.vars[e]=parseValue(this.textContent.trim()),updateContent()),this.style.display="none"}}customElements.define("global-var",n);class l extends HTMLElement{connectedCallback(){const e=this.getAttribute("name"),t=this.innerHTML.trim();e&&(globalStore.funcs[e]={html:t,execute:function(e={}){let t=this.html;for(const[n,l]of Object.entries(e))t=t.replace(new RegExp(`\\$\\{#local\\.${n}\\}`,"g"),escapeHtml("object"==typeof l?JSON.stringify(l):String(l)));return t=t.replace(/\$\{#(\w+)\}/g,(e,t)=>{const n=globalStore.vars[t];return escapeHtml("object"==typeof n?JSON.stringify(n):String(n))}),t}},updateContent()),this.style.display="none"}}customElements.define("def-func",l);class o extends HTMLElement{connectedCallback(){updateContent()}}customElements.define("exec-func",o);class i extends HTMLElement{connectedCallback(){this.style.display="none",updateContent()}}customElements.define("if-jum",i);class s extends HTMLElement{connectedCallback(){this.style.display="none",updateContent()}}customElements.define("elif-jum",s);class r extends HTMLElement{connectedCallback(){this.style.display="none",updateContent()}}customElements.define("else-jum",r);class a extends HTMLElement{connectedCallback(){this.style.display="none",updateContent()}}customElements.define("while-loop",a);class c extends HTMLElement{connectedCallback(){this.style.display="none",updateContent()}}function u(){e=new MutationObserver(()=>{updateContent()}),e.observe(document.body,{childList:!0,subtree:!0,characterData:!0,attributes:!0,attributeFilter:["params","exp","style","init","update"]})}customElements.define("for-loop",c),window.setGlobalVar=function(e,t){e&&"string"==typeof e&&(globalStore.vars[e]=t,updateContent())};const d=document.createElement("style");d.textContent='\n\t\tset-var, def-func, global-var, if-jum, elif-jum, else-jum, while-loop, for-loop { display: none !important; }\n\t\texec-func { display: block; }\n\t\tif-jum[style*="display: block"], elif-jum[style*="display: block"], else-jum[style*="display: block"],\n\t\twhile-loop[style*="display: block"], for-loop[style*="display: block"] { display: block !important; }\n\t',document.head.appendChild(d),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{u(),updateContent()}):(u(),updateContent())}();